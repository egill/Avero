{
  "projectName": "Fix Dashboard in command.e18n.net",
  "branchName": "feature/fix-dashboard-in-commande18nnet",
  "overview": "Fix bugs and improve stability",
  "audience": "End users of the application",
  "scope": "Single component or module",
  "successCriteria": "Feature works as specified in acceptance criteria",
  "userStories": [
    {
      "id": "US-001",
      "title": "Fix the dashboard on command.e18n.net, it's not working",
      "category": "fix",
      "priority": 1,
      "acceptanceCriteria": [
        "Dashboard receives real-time zone events from gateway:events PubSub channel",
        "Dashboard receives real-time gate events from gates PubSub channel",
        "Dashboard receives journey events with correct message format",
        "Tests pass",
        "Documentation updated"
      ],
      "files": [
        "command/lib/avero_command_web/live/dashboard_live.ex",
        "command/lib/avero_command/mqtt/event_router.ex"
      ],
      "instructions": "Fixed three PubSub issues: (1) Zone events - dashboard subscribed to 'zones' but EventRouter broadcasts to 'gateway:events', (2) Gate events - no PubSub broadcast was happening for gate state changes, (3) Journey events - dashboard expected :journey_completed but journeys.ex broadcasts :journey_created",
      "passes": true
    },
    {
      "id": "US-002",
      "title": "Make sure all components are connected correctly",
      "category": "feat",
      "priority": 2,
      "acceptanceCriteria": [
        "Make sure all components are connected correctly is implemented",
        "Tests pass",
        "Documentation updated",
        "All validation commands in AGENTS.md pass"
      ],
      "files": [],
      "instructions": "The PubSub fixes in US-001 address most component connectivity issues. Remaining: verify gates appear in dashboard when gateway-poc connects.",
      "passes": true
    },
    {
      "id": "US-003",
      "title": "Make the POS occupancy view work in it",
      "category": "feat",
      "priority": 3,
      "acceptanceCriteria": [
        "POS zones receive zone_entry events and update occupied state",
        "POS zones receive zone_exit events and decrement count",
        "POS zones receive payment events and show paid status",
        "Tests pass"
      ],
      "files": [
        "command/lib/avero_command_web/live/dashboard_live.ex"
      ],
      "instructions": "Fixed by subscribing to gateway:events channel instead of zones. The update_pos_zone/3 function handles :zone_entry, :zone_exit, and :payment events correctly.",
      "passes": true
    },
    {
      "id": "US-004",
      "title": "Make the live POS view (showing how many people are present in each zone, if they've paid etc)",
      "category": "feat",
      "priority": 3,
      "acceptanceCriteria": [
        "POS zones display person count",
        "POS zones display occupied/empty state",
        "POS zones display paid status with checkmark badge",
        "Real-time updates work via PubSub"
      ],
      "files": [
        "command/lib/avero_command_web/live/dashboard_live.ex"
      ],
      "instructions": "Fixed by subscribing to gateway:events channel. The pos_zone component displays count, occupied state (amber), and paid state (green with checkmark).",
      "passes": true
    }
  ],
  "notes": {
    "fixesSummary": "Three critical PubSub issues were identified and fixed: (1) Dashboard subscribed to wrong channel for zone events, (2) Gate events were not being broadcast to PubSub, (3) Journey event handler expected wrong message atom",
    "changedFiles": [
      "command/lib/avero_command_web/live/dashboard_live.ex - Fixed PubSub subscriptions and journey event handler",
      "command/lib/avero_command/mqtt/event_router.ex - Added gate event broadcast to 'gates' channel"
    ]
  }
}
