{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": { "type": "grafana", "uid": "-- Grafana --" },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "id": null,
  "links": [],
  "panels": [
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
      "id": 100,
      "panels": [],
      "title": "ðŸ”´ Real-Time Status",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [
            { "options": { "0": { "color": "green", "index": 0, "text": "Closed" } }, "type": "value" },
            { "options": { "1": { "color": "yellow", "index": 1, "text": "Moving" } }, "type": "value" },
            { "options": { "2": { "color": "blue", "index": 2, "text": "Open" } }, "type": "value" }
          ],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] }
        }
      },
      "gridPos": { "h": 4, "w": 4, "x": 0, "y": 1 },
      "id": 1,
      "options": { "colorMode": "background", "graphMode": "none", "justifyMode": "center", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "gateway_gate_state{site=\"NETTO-GRANDI\"}", "refId": "A" }],
      "title": "Gate State",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 5 }, { "color": "red", "value": 10 }] },
          "unit": "short"
        }
      },
      "gridPos": { "h": 4, "w": 4, "x": 4, "y": 1 },
      "id": 2,
      "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "gateway_active_tracks{site=\"NETTO-GRANDI\"}", "refId": "A" }],
      "title": "Active Tracks",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "mode": "absolute", "steps": [{ "color": "blue", "value": null }] },
          "unit": "short"
        }
      },
      "gridPos": { "h": 4, "w": 4, "x": 8, "y": 1 },
      "id": 3,
      "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "gateway_authorized_tracks{site=\"NETTO-GRANDI\"}", "refId": "A" }],
      "title": "Authorized",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
          "unit": "short"
        }
      },
      "gridPos": { "h": 4, "w": 4, "x": 12, "y": 1 },
      "id": 4,
      "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "increase(gateway_gate_commands_total{site=\"NETTO-GRANDI\"}[1h])", "refId": "A" }],
      "title": "Gate Opens (1h)",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
          "unit": "short"
        }
      },
      "gridPos": { "h": 4, "w": 4, "x": 16, "y": 1 },
      "id": 5,
      "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "increase(gateway_exits_total{site=\"NETTO-GRANDI\"}[1h])", "refId": "A" }],
      "title": "Exits (1h)",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "mode": "absolute", "steps": [{ "color": "purple", "value": null }] },
          "unit": "short"
        }
      },
      "gridPos": { "h": 4, "w": 4, "x": 20, "y": 1 },
      "id": 6,
      "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "increase(gateway_acc_matched_total{site=\"NETTO-GRANDI\"}[1h])", "refId": "A" }],
      "title": "Payments (1h)",
      "type": "stat"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 5 },
      "id": 101,
      "panels": [],
      "title": "ðŸ“Š Day-over-Day Comparison",
      "type": "row"
    },
    {
      "datasource": { "type": "grafana-postgresql-datasource", "uid": "P40AE60E18F02DE32" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
          "unit": "short"
        }
      },
      "gridPos": { "h": 4, "w": 5, "x": 0, "y": 6 },
      "id": 10,
      "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "/^today$/", "values": false }, "textMode": "value_and_name" },
      "targets": [{
        "datasource": { "type": "grafana-postgresql-datasource", "uid": "P40AE60E18F02DE32" },
        "format": "table",
        "rawSql": "WITH today AS (\n  SELECT COUNT(*) as cnt FROM person_journeys\n  WHERE site = 'netto' AND time >= CURRENT_DATE AND outcome IS NOT NULL\n),\nyesterday AS (\n  SELECT COUNT(*) as cnt FROM person_journeys\n  WHERE site = 'netto' AND time >= CURRENT_DATE - INTERVAL '1 day'\n    AND time < CURRENT_DATE AND outcome IS NOT NULL\n)\nSELECT today.cnt as today, yesterday.cnt as yesterday,\n       CASE WHEN yesterday.cnt > 0 THEN ROUND((today.cnt - yesterday.cnt)::numeric / yesterday.cnt * 100, 1) ELSE 0 END as pct\nFROM today, yesterday;",
        "refId": "A"
      }],
      "title": "Exits Today vs Yesterday",
      "type": "stat"
    },
    {
      "datasource": { "type": "grafana-postgresql-datasource", "uid": "P40AE60E18F02DE32" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "mode": "absolute", "steps": [{ "color": "purple", "value": null }] },
          "unit": "short"
        }
      },
      "gridPos": { "h": 4, "w": 5, "x": 5, "y": 6 },
      "id": 11,
      "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "/^today$/", "values": false }, "textMode": "value_and_name" },
      "targets": [{
        "datasource": { "type": "grafana-postgresql-datasource", "uid": "P40AE60E18F02DE32" },
        "format": "table",
        "rawSql": "WITH today AS (\n  SELECT COUNT(*) as cnt FROM person_journeys\n  WHERE site = 'netto' AND time >= CURRENT_DATE AND outcome = 'paid_exit'\n),\nyesterday AS (\n  SELECT COUNT(*) as cnt FROM person_journeys\n  WHERE site = 'netto' AND time >= CURRENT_DATE - INTERVAL '1 day'\n    AND time < CURRENT_DATE AND outcome = 'paid_exit'\n)\nSELECT today.cnt as today, yesterday.cnt as yesterday\nFROM today, yesterday;",
        "refId": "A"
      }],
      "title": "Paid Exits Today vs Yesterday",
      "type": "stat"
    },
    {
      "datasource": { "type": "grafana-postgresql-datasource", "uid": "P40AE60E18F02DE32" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "mode": "absolute", "steps": [{ "color": "orange", "value": null }] },
          "unit": "short"
        }
      },
      "gridPos": { "h": 4, "w": 5, "x": 10, "y": 6 },
      "id": 12,
      "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "/^today$/", "values": false }, "textMode": "value_and_name" },
      "targets": [{
        "datasource": { "type": "grafana-postgresql-datasource", "uid": "P40AE60E18F02DE32" },
        "format": "table",
        "rawSql": "WITH today AS (\n  SELECT COUNT(*) as cnt FROM person_journeys\n  WHERE site = 'netto' AND time >= CURRENT_DATE AND outcome = 'unpaid_exit'\n),\nyesterday AS (\n  SELECT COUNT(*) as cnt FROM person_journeys\n  WHERE site = 'netto' AND time >= CURRENT_DATE - INTERVAL '1 day'\n    AND time < CURRENT_DATE AND outcome = 'unpaid_exit'\n)\nSELECT today.cnt as today, yesterday.cnt as yesterday\nFROM today, yesterday;",
        "refId": "A"
      }],
      "title": "Unpaid Exits Today vs Yesterday",
      "type": "stat"
    },
    {
      "datasource": { "type": "grafana-postgresql-datasource", "uid": "P40AE60E18F02DE32" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "mode": "absolute", "steps": [{ "color": "red", "value": null }] },
          "unit": "short"
        }
      },
      "gridPos": { "h": 4, "w": 5, "x": 15, "y": 6 },
      "id": 13,
      "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "/^today$/", "values": false }, "textMode": "value_and_name" },
      "targets": [{
        "datasource": { "type": "grafana-postgresql-datasource", "uid": "P40AE60E18F02DE32" },
        "format": "table",
        "rawSql": "WITH today AS (\n  SELECT COUNT(*) as cnt FROM person_journeys\n  WHERE site = 'netto' AND time >= CURRENT_DATE AND outcome = 'lost_unauthorized'\n),\nyesterday AS (\n  SELECT COUNT(*) as cnt FROM person_journeys\n  WHERE site = 'netto' AND time >= CURRENT_DATE - INTERVAL '1 day'\n    AND time < CURRENT_DATE AND outcome = 'lost_unauthorized'\n)\nSELECT today.cnt as today, yesterday.cnt as yesterday\nFROM today, yesterday;",
        "refId": "A"
      }],
      "title": "Lost Tracks Today vs Yesterday",
      "type": "stat"
    },
    {
      "datasource": { "type": "grafana-postgresql-datasource", "uid": "P40AE60E18F02DE32" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "mode": "absolute", "steps": [{ "color": "yellow", "value": null }] },
          "unit": "short"
        }
      },
      "gridPos": { "h": 4, "w": 4, "x": 20, "y": 6 },
      "id": 14,
      "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "/^today$/", "values": false }, "textMode": "value_and_name" },
      "targets": [{
        "datasource": { "type": "grafana-postgresql-datasource", "uid": "P40AE60E18F02DE32" },
        "format": "table",
        "rawSql": "WITH today AS (\n  SELECT COUNT(*) as cnt FROM person_journeys\n  WHERE site = 'netto' AND time >= CURRENT_DATE AND tailgated = true\n),\nyesterday AS (\n  SELECT COUNT(*) as cnt FROM person_journeys\n  WHERE site = 'netto' AND time >= CURRENT_DATE - INTERVAL '1 day'\n    AND time < CURRENT_DATE AND tailgated = true\n)\nSELECT today.cnt as today, yesterday.cnt as yesterday\nFROM today, yesterday;",
        "refId": "A"
      }],
      "title": "Tailgating Today vs Yesterday",
      "type": "stat"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 10 },
      "id": 102,
      "panels": [],
      "title": "ðŸŽ¯ Journey Outcomes",
      "type": "row"
    },
    {
      "datasource": { "type": "grafana-postgresql-datasource", "uid": "P40AE60E18F02DE32" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "fillOpacity": 80, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineWidth": 1, "scaleDistribution": { "type": "linear" }, "thresholdsStyle": { "mode": "off" } },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] }
        },
        "overrides": [
          { "matcher": { "id": "byName", "options": "paid_exit" }, "properties": [{ "id": "color", "value": { "fixedColor": "green", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "unpaid_exit" }, "properties": [{ "id": "color", "value": { "fixedColor": "orange", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "lost_unauthorized" }, "properties": [{ "id": "color", "value": { "fixedColor": "red", "mode": "fixed" } }] }
        ]
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 11 },
      "id": 20,
      "options": { "barRadius": 0.05, "barWidth": 0.7, "groupWidth": 0.7, "legend": { "calcs": ["sum"], "displayMode": "table", "placement": "right", "showLegend": true }, "orientation": "horizontal", "showValue": "always", "stacking": "none", "tooltip": { "mode": "single", "sort": "none" }, "xTickLabelRotation": 0, "xTickLabelSpacing": 0 },
      "targets": [{
        "datasource": { "type": "grafana-postgresql-datasource", "uid": "P40AE60E18F02DE32" },
        "format": "table",
        "rawSql": "SELECT outcome, COUNT(*) as count\nFROM person_journeys\nWHERE site = 'netto' AND time > NOW() - INTERVAL '24 hours' AND outcome IS NOT NULL\nGROUP BY outcome\nORDER BY count DESC;",
        "refId": "A"
      }],
      "title": "Journey Outcomes (24h)",
      "transformations": [{ "id": "convertFieldType", "options": { "conversions": [{ "destinationType": "number", "targetField": "count" }] } }],
      "type": "barchart"
    },
    {
      "datasource": { "type": "grafana-postgresql-datasource", "uid": "P40AE60E18F02DE32" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "decimals": 1,
          "thresholds": { "mode": "absolute", "steps": [{ "color": "red", "value": null }, { "color": "yellow", "value": 50 }, { "color": "green", "value": 70 }] },
          "unit": "percent"
        }
      },
      "gridPos": { "h": 4, "w": 4, "x": 12, "y": 11 },
      "id": 21,
      "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "targets": [{
        "datasource": { "type": "grafana-postgresql-datasource", "uid": "P40AE60E18F02DE32" },
        "format": "table",
        "rawSql": "SELECT ROUND(\n  COUNT(*) FILTER (WHERE outcome = 'paid_exit')::numeric /\n  NULLIF(COUNT(*) FILTER (WHERE outcome IS NOT NULL), 0) * 100, 1\n) as paid_rate\nFROM person_journeys\nWHERE site = 'netto' AND time > NOW() - INTERVAL '24 hours';",
        "refId": "A"
      }],
      "title": "Paid Exit Rate (24h)",
      "type": "stat"
    },
    {
      "datasource": { "type": "grafana-postgresql-datasource", "uid": "P40AE60E18F02DE32" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "decimals": 1,
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 5 }, { "color": "red", "value": 10 }] },
          "unit": "percent"
        }
      },
      "gridPos": { "h": 4, "w": 4, "x": 16, "y": 11 },
      "id": 22,
      "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "targets": [{
        "datasource": { "type": "grafana-postgresql-datasource", "uid": "P40AE60E18F02DE32" },
        "format": "table",
        "rawSql": "SELECT ROUND(\n  COUNT(*) FILTER (WHERE tailgated = true)::numeric /\n  NULLIF(COUNT(*), 0) * 100, 1\n) as tailgate_rate\nFROM person_journeys\nWHERE site = 'netto' AND time > NOW() - INTERVAL '24 hours' AND outcome IS NOT NULL;",
        "refId": "A"
      }],
      "title": "Tailgating Rate (24h)",
      "type": "stat"
    },
    {
      "datasource": { "type": "grafana-postgresql-datasource", "uid": "P40AE60E18F02DE32" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "decimals": 1,
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 10 }, { "color": "red", "value": 20 }] },
          "unit": "percent"
        }
      },
      "gridPos": { "h": 4, "w": 4, "x": 20, "y": 11 },
      "id": 23,
      "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "targets": [{
        "datasource": { "type": "grafana-postgresql-datasource", "uid": "P40AE60E18F02DE32" },
        "format": "table",
        "rawSql": "SELECT ROUND(\n  COUNT(*) FILTER (WHERE outcome = 'lost_unauthorized')::numeric /\n  NULLIF(COUNT(*) FILTER (WHERE outcome IS NOT NULL), 0) * 100, 1\n) as lost_rate\nFROM person_journeys\nWHERE site = 'netto' AND time > NOW() - INTERVAL '24 hours';",
        "refId": "A"
      }],
      "title": "Lost Track Rate (24h)",
      "type": "stat"
    },
    {
      "datasource": { "type": "grafana-postgresql-datasource", "uid": "P40AE60E18F02DE32" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "decimals": 1,
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 20 }, { "color": "red", "value": 40 }] },
          "unit": "percent"
        }
      },
      "gridPos": { "h": 4, "w": 4, "x": 12, "y": 15 },
      "id": 24,
      "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "targets": [{
        "datasource": { "type": "grafana-postgresql-datasource", "uid": "P40AE60E18F02DE32" },
        "format": "table",
        "rawSql": "SELECT ROUND(\n  COUNT(*) FILTER (WHERE outcome = 'unpaid_exit')::numeric /\n  NULLIF(COUNT(*) FILTER (WHERE outcome IS NOT NULL), 0) * 100, 1\n) as unpaid_rate\nFROM person_journeys\nWHERE site = 'netto' AND time > NOW() - INTERVAL '24 hours';",
        "refId": "A"
      }],
      "title": "Unpaid Exit Rate (24h)",
      "type": "stat"
    },
    {
      "datasource": { "type": "grafana-postgresql-datasource", "uid": "P40AE60E18F02DE32" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "decimals": 1,
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
          "unit": "s"
        }
      },
      "gridPos": { "h": 4, "w": 4, "x": 16, "y": 15 },
      "id": 25,
      "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "targets": [{
        "datasource": { "type": "grafana-postgresql-datasource", "uid": "P40AE60E18F02DE32" },
        "format": "table",
        "rawSql": "SELECT ROUND(AVG(duration_ms) / 1000.0, 1) as avg_duration\nFROM person_journeys\nWHERE site = 'netto' AND time > NOW() - INTERVAL '24 hours' AND duration_ms IS NOT NULL;",
        "refId": "A"
      }],
      "title": "Avg Journey Duration (24h)",
      "type": "stat"
    },
    {
      "datasource": { "type": "grafana-postgresql-datasource", "uid": "P40AE60E18F02DE32" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "decimals": 1,
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
          "unit": "s"
        }
      },
      "gridPos": { "h": 4, "w": 4, "x": 20, "y": 15 },
      "id": 26,
      "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "targets": [{
        "datasource": { "type": "grafana-postgresql-datasource", "uid": "P40AE60E18F02DE32" },
        "format": "table",
        "rawSql": "SELECT ROUND(AVG(total_pos_dwell_ms) / 1000.0, 1) as avg_pos_dwell\nFROM person_journeys\nWHERE site = 'netto' AND time > NOW() - INTERVAL '24 hours' AND total_pos_dwell_ms IS NOT NULL;",
        "refId": "A"
      }],
      "title": "Avg POS Dwell (24h)",
      "type": "stat"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 19 },
      "id": 103,
      "panels": [],
      "title": "ðŸ’³ Payment & ACC Activity",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 20, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
          "unit": "short"
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 20 },
      "id": 30,
      "options": { "legend": { "calcs": [], "displayMode": "list", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
      "targets": [
        { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "gateway_pos_occupancy{site=\"NETTO-GRANDI\"}", "legendFormat": "{{zone_id}}", "refId": "A" }
      ],
      "title": "POS Zone Occupancy (Live)",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "grafana-postgresql-datasource", "uid": "P40AE60E18F02DE32" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 20, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
          "unit": "short"
        },
        "overrides": [
          { "matcher": { "id": "byName", "options": "matched" }, "properties": [{ "id": "color", "value": { "fixedColor": "green", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "unmatched" }, "properties": [{ "id": "color", "value": { "fixedColor": "red", "mode": "fixed" } }] }
        ]
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 20 },
      "id": 31,
      "options": { "legend": { "calcs": ["sum"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
      "targets": [{
        "datasource": { "type": "grafana-postgresql-datasource", "uid": "P40AE60E18F02DE32" },
        "format": "time_series",
        "rawSql": "SELECT\n  time_bucket('5 minutes', time) as time,\n  COUNT(*) FILTER (WHERE data->>'t' = 'matched') as matched,\n  COUNT(*) FILTER (WHERE data->>'t' = 'unmatched') as unmatched\nFROM events\nWHERE site = 'netto' AND event_type = 'gateway.acc' AND $__timeFilter(time)\nGROUP BY 1 ORDER BY 1;",
        "refId": "A"
      }],
      "title": "ACC Events (Matched vs Unmatched)",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 28 },
      "id": 104,
      "panels": [],
      "title": "ðŸšª Gate Performance",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "custom": { "fillOpacity": 70, "lineWidth": 0, "spanNulls": false },
          "mappings": [
            { "options": { "0": { "color": "green", "index": 0, "text": "Closed" } }, "type": "value" },
            { "options": { "1": { "color": "yellow", "index": 1, "text": "Moving" } }, "type": "value" },
            { "options": { "2": { "color": "blue", "index": 2, "text": "Open" } }, "type": "value" }
          ],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] }
        }
      },
      "gridPos": { "h": 4, "w": 24, "x": 0, "y": 29 },
      "id": 40,
      "options": { "alignValue": "center", "legend": { "displayMode": "list", "placement": "bottom", "showLegend": false }, "mergeValues": true, "rowHeight": 0.9, "showValue": "auto", "tooltip": { "mode": "single", "sort": "none" } },
      "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "gateway_gate_state{site=\"NETTO-GRANDI\"}", "legendFormat": "Gate", "refId": "A" }],
      "title": "Gate State Timeline",
      "type": "state-timeline"
    },
    {
      "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 500 }, { "color": "red", "value": 1000 }] },
          "unit": "Âµs"
        }
      },
      "gridPos": { "h": 4, "w": 6, "x": 0, "y": 33 },
      "id": 41,
      "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "gateway_gate_latency_p99_us{site=\"NETTO-GRANDI\"}", "refId": "A" }],
      "title": "Gate Latency (p99)",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 1 }, { "color": "red", "value": 5 }] },
          "unit": "short"
        }
      },
      "gridPos": { "h": 4, "w": 6, "x": 6, "y": 33 },
      "id": 42,
      "options": { "colorMode": "value", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "targets": [{ "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "increase(gateway_gate_faults_total{site=\"NETTO-GRANDI\"}[1h])", "refId": "A" }],
      "title": "Gate Faults (1h)",
      "type": "stat"
    },
    {
      "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 20, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
          "unit": "Âµs"
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 33 },
      "id": 43,
      "options": { "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
      "targets": [
        { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "gateway_gate_latency_p50_us{site=\"NETTO-GRANDI\"}", "legendFormat": "p50", "refId": "A" },
        { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "gateway_gate_latency_p95_us{site=\"NETTO-GRANDI\"}", "legendFormat": "p95", "refId": "B" },
        { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "gateway_gate_latency_p99_us{site=\"NETTO-GRANDI\"}", "legendFormat": "p99", "refId": "C" }
      ],
      "title": "Gate Latency Over Time",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 20, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
          "unit": "short"
        }
      },
      "gridPos": { "h": 4, "w": 12, "x": 0, "y": 37 },
      "id": 44,
      "options": { "legend": { "calcs": [], "displayMode": "list", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
      "targets": [
        { "datasource": { "type": "prometheus", "uid": "PBFA97CFB590B2093" }, "expr": "rate(gateway_gate_commands_total{site=\"NETTO-GRANDI\"}[5m]) * 60", "legendFormat": "Gate Opens/min", "refId": "A" }
      ],
      "title": "Gate Open Rate (per min)",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 41 },
      "id": 105,
      "panels": [],
      "title": "ðŸ“ˆ Historical Trends",
      "type": "row"
    },
    {
      "datasource": { "type": "grafana-postgresql-datasource", "uid": "P40AE60E18F02DE32" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "auto", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
          "unit": "short"
        },
        "overrides": [
          { "matcher": { "id": "byName", "options": "today" }, "properties": [{ "id": "color", "value": { "fixedColor": "blue", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "yesterday" }, "properties": [{ "id": "color", "value": { "fixedColor": "grey", "mode": "fixed" } }, { "id": "custom.lineStyle", "value": { "dash": [10, 10], "fill": "dash" } }] }
        ]
      },
      "gridPos": { "h": 8, "w": 24, "x": 0, "y": 42 },
      "id": 50,
      "options": { "legend": { "calcs": ["sum"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
      "targets": [{
        "datasource": { "type": "grafana-postgresql-datasource", "uid": "P40AE60E18F02DE32" },
        "format": "time_series",
        "rawSql": "WITH hours AS (\n  SELECT generate_series(0, 23) as hour\n),\ntoday_data AS (\n  SELECT EXTRACT(HOUR FROM time AT TIME ZONE 'Atlantic/Reykjavik')::int as hour, COUNT(*) as cnt\n  FROM person_journeys\n  WHERE site = 'netto' AND time >= CURRENT_DATE AND outcome IS NOT NULL\n  GROUP BY 1\n),\nyesterday_data AS (\n  SELECT EXTRACT(HOUR FROM time AT TIME ZONE 'Atlantic/Reykjavik')::int as hour, COUNT(*) as cnt\n  FROM person_journeys\n  WHERE site = 'netto' AND time >= CURRENT_DATE - INTERVAL '1 day'\n    AND time < CURRENT_DATE AND outcome IS NOT NULL\n  GROUP BY 1\n)\nSELECT (CURRENT_DATE + (h.hour || ' hours')::interval) AT TIME ZONE 'Atlantic/Reykjavik' as time,\n       COALESCE(t.cnt, 0) as today,\n       COALESCE(y.cnt, 0) as yesterday\nFROM hours h\nLEFT JOIN today_data t ON h.hour = t.hour\nLEFT JOIN yesterday_data y ON h.hour = y.hour\nORDER BY h.hour;",
        "refId": "A"
      }],
      "title": "Exits by Hour: Today vs Yesterday",
      "transformations": [],
      "type": "timeseries"
    },
    {
      "datasource": { "type": "grafana-postgresql-datasource", "uid": "P40AE60E18F02DE32" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 30, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 1, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "normal" }, "thresholdsStyle": { "mode": "off" } },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
          "unit": "short"
        },
        "overrides": [
          { "matcher": { "id": "byName", "options": "paid_exit" }, "properties": [{ "id": "color", "value": { "fixedColor": "green", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "unpaid_exit" }, "properties": [{ "id": "color", "value": { "fixedColor": "orange", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "lost_unauthorized" }, "properties": [{ "id": "color", "value": { "fixedColor": "red", "mode": "fixed" } }] }
        ]
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 50 },
      "id": 51,
      "options": { "legend": { "calcs": ["sum"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
      "targets": [{
        "datasource": { "type": "grafana-postgresql-datasource", "uid": "P40AE60E18F02DE32" },
        "format": "time_series",
        "rawSql": "SELECT\n  time_bucket('1 hour', time) as time,\n  COUNT(*) FILTER (WHERE outcome = 'paid_exit') as paid_exit,\n  COUNT(*) FILTER (WHERE outcome = 'unpaid_exit') as unpaid_exit,\n  COUNT(*) FILTER (WHERE outcome = 'lost_unauthorized') as lost_unauthorized\nFROM person_journeys\nWHERE site = 'netto' AND $__timeFilter(time) AND outcome IS NOT NULL\nGROUP BY 1 ORDER BY 1;",
        "refId": "A"
      }],
      "title": "Journey Outcomes Over Time (Stacked)",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "grafana-postgresql-datasource", "uid": "P40AE60E18F02DE32" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 20, "gradientMode": "none", "hideFrom": { "legend": false, "tooltip": false, "viz": false }, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": { "type": "linear" }, "showPoints": "never", "spanNulls": false, "stacking": { "group": "A", "mode": "none" }, "thresholdsStyle": { "mode": "off" } },
          "mappings": [],
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] },
          "unit": "percent"
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 50 },
      "id": 52,
      "options": { "legend": { "calcs": ["mean", "lastNotNull"], "displayMode": "table", "placement": "bottom", "showLegend": true }, "tooltip": { "mode": "multi", "sort": "desc" } },
      "targets": [{
        "datasource": { "type": "grafana-postgresql-datasource", "uid": "P40AE60E18F02DE32" },
        "format": "time_series",
        "rawSql": "SELECT\n  time_bucket('1 hour', time) as time,\n  ROUND(COUNT(*) FILTER (WHERE outcome = 'paid_exit')::numeric / NULLIF(COUNT(*), 0) * 100, 1) as paid_rate\nFROM person_journeys\nWHERE site = 'netto' AND $__timeFilter(time) AND outcome IS NOT NULL\nGROUP BY 1 ORDER BY 1;",
        "refId": "A"
      }],
      "title": "Paid Exit Rate Over Time",
      "type": "timeseries"
    }
  ],
  "schemaVersion": 38,
  "style": "dark",
  "tags": ["netto", "grandi", "production"],
  "templating": { "list": [] },
  "time": { "from": "now-24h", "to": "now" },
  "timepicker": {
    "refresh_intervals": ["5s", "10s", "30s", "1m", "5m", "15m", "30m", "1h", "2h", "1d"]
  },
  "timezone": "Atlantic/Reykjavik",
  "title": "NettÃ³: Grandi",
  "uid": "netto-grandi",
  "version": 1,
  "weekStart": "monday"
}
