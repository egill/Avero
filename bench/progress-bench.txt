# Ralph Progress Log - Gate Latency Benchmark
Started: 2026-01-07

## Codebase Patterns
- RS485: Status byte at frame[4], NOT frame[10]
- RS485: 0x02 (right open) = resting = CLOSED
- RS485: Checksum = sum all 18 bytes + 1 == 0
- RS485: Read with accumulation, 200ms timeout
- CloudPlus: XOR checksum, address=0xFF, door=0x01
- CloudPlus: Gate closes idle connections - reconnect per trial
- Polling: 250ms minimum interval between RS485 queries
- Serial: 19200 baud, 100ms port timeout

## Key Files
- src/io/rs485.rs (production RS485 implementation)
- src/io/cloudplus.rs (production CloudPlus TCP)
- src/bin/gate_test.rs (working gate test utility)
- bench/rust/src/main.rs (Rust benchmark)
- bench/go/main.go (Go benchmark)
- bench/build.sh (cross-compile script)

## Hardware
- Pi: avero@100.65.110.63
- RS485: /dev/ttyAMA4 @ 19200
- Gate: 192.168.0.245:8000

## Goal
Compare Rust vs Go latency for:
TCP command sent â†’ RS485 detects door moving

Expected baseline: ~300-400ms (gate response + RS485 RTT)

---

## 2026-01-07 - Setup
- Created bench/ directory structure
- Build script working (cargo zigbuild + GOOS/GOARCH)
- Deployed to Pi, RS485 connects successfully
- **Issues encountered:**
  - Used wrong RS485 byte position (10 vs 4)
  - Door status 0x02 not recognized as closed
  - Gate closes idle TCP - needed fresh connection per trial
- **Status:** US-001 through US-004 still failing
---
